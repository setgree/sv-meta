---
title: "3-SA-meta-analyis.Rmd"
author: "Seth Green"
date: "8/19/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

### First, an overall meta-analysis. 
```{r setup}
rm(list = ls())
library(metafor)
library(ggplot2)
dat <- readRDS(file = './data/sa_meta_data_for_analysis.rds')
```

```{r initial_exploration}

#first, is there a relationship between effect size and variance?
summary(lm(formula = d ~ se_d, data =  dat))
ggplot(data = dat, mapping = aes(x = d, y = se_d)) + 
  geom_point() + 
  geom_smooth(method = 'lm') #I'd say so

# how about the overall relationship between lab/field and d? 
summary(lm(formula = d ~ lab_or_field, data =  dat)) 
# field experiments are 0.1 lower, right off the bat

# study type?
summary(lm(formula = d ~ study_design, data =  dat)) 
# yep, meaningful relationship

# first crack at meta-analysis
robust(x = rma(yi = d, vi = var_d, data = dat), cluster = dat$unique_paper_id)
# by study type?
rcts <- dat %>% filter(study_design == 'rct')
robust(x = rma(yi = d, vi = var_d, data = rcts), cluster = rcts$unique_paper_id)

quasis <- dat %>% filter(study_design == 'quasi-experimental')
robust(x = rma(yi = d, vi = var_d, data = quasis), cluster = quasis$unique_paper_id)

rcts_and_quasi <- dat %>% filter(study_design == 'rct' | study_design == 'quasi-experimental')
robust(x = rma(yi = d, vi = var_d, data = rcts_and_quasi), cluster = rcts_and_quasi$unique_paper_id)

observational <- dat %>% filter(study_design == 'pre-post' | study_design == 'cross-sectional')
robust(x = rma(yi = d, vi = var_d, data = observational), cluster = observational$unique_paper_id)
```

* Analysis of subgroups or subsets: We will compare subsets of the data according to classifications of evaluation methodology (i.e., observational vs. quasi-experimental vs. experimental methods) and of outcome measurement (i.e., general behavior indices vs. perpetration behavior, and attitudinal measurement vs. behavioral measurement). 
Evaluate the overall effect size of behavioral outcomes for all of the studies in the dataset, both in the short- and in the long-term. 
Compare the effect size of behavioral outcomes for experimental and quasi-experimental studies vs. non-experimental observational studies, both in the short- and in the long-term. 
Compare the effect size of behavioral outcomes for studies with random assignment vs. quasi-experimental studies, both in the short- and in the long-term. 
Evaluate at the effect size of perpetration behavioral outcomes for only studies with random assignment, both in the short- and in the long-term. 
Compare the effect size of behavioral outcomes and attitudinal outcomes, both in the short- and long-term, among the quasi-experimental and randomly-assigned studies. (The covariation of attitudes and behaviors will be assessed in the full sample of studies.)

Analysis plan discussed 
what is the average effect size:
RCT – behavior
RCT – attitude
RCT+Quasi – behavior
RCT+Quasi – attitude
Everything – behavior
Everything – attitude
What is the association between attitudes and behaviors (temporal match) – this answers our question of ‘should we care about attitudes?’. We are only looking at studies that measure both attitudes and behavior in their outcomes. 

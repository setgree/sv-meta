---
title: "Descriptives"
subtitle: ""
output:
  rmarkdown::html_document:
    smart: true
    theme: spacelab
    number_sections: no
    toc_float:
      collapsed: true
    toc_depth: 4
editor_options: 
  chunk_output_type: console
---

```{r echo=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE, 
                      results = 'asis')
```

```{r setup_libraries}
library(clipr)
library(DT)
library(ggtext) # figures
library(glue) # convenience
library(janitor)
library(kableExtra)
library(knitr) # tables
library(metafor)
library(patchwork)
library(rstatix) # summary
library(tidyverse)
Sys.setenv(CLIPR_ALLOW = TRUE)
```


```{r load_data}
dat <- readRDS(file = './data/sa_meta_data_for_analysis.rds') %>%
  select(unique_study_id, scale_type, everything()) %>%
  mutate(labels = paste(tools::toTitleCase(word(author)), year)) %>%
  group_by(unique_study_id) %>%
  mutate(
    attitudes_behaviors = case_when(
      all(c('attitudes', 'behavior') %in% scale_type) ~ 0,
      scale_type == 'attitudes' ~ 1,
      scale_type == 'behavior' ~ 2)) %>%
  ungroup() 
```


We recovered XXX manuscripts from our search that qualified methodologically and theoretically. 
```{r}
dat %>% 
  select(unique_study_id, unique_paper_id) %>% 
  summarise(n_papers = max(unique_paper_id),
            n_studies = max(unique_study_id))
```

We found XX studies that measuredself-reported behavior.
```{r}
dat %>% 
  select(unique_study_id, scale_type) %>% 
  group_by(scale_type) %>% 
  summarise(n_unique_studies = n_distinct(unique_study_id)) 
```

XX of these studies measured behavior only in the immediate aftermath of the intervention, while xx included long-term measures.  
```{r}
dat %>% 
  filter(scale_type == "behavior") %>% 
  select(unique_study_id, delay) %>% 
  drop_na(delay) %>% 
  group_by(unique_study_id) %>% 
  mutate(max_delay = max(delay),
         only_short_term = max_delay == 0) %>% 
  count(only_short_term) %>% 
  ungroup() %>% 
  count(only_short_term)
```

To do so, we break down our dataset according to four types of study designs: experimental studies, quasi experimental studies, and observational studies. as presented in Table X, 
```{r}
dat %>% 
  select(unique_study_id, scale_type, study_design, d) %>% 
  filter(scale_type == "behavior") %>% 
  group_by(unique_study_id, study_design) %>% 
  summarise(mean_d_by_study_x_design = mean(d)) %>% 
  group_by(study_design) %>% 
  summarise(n = n(),
            mean_d_by_design = mean(mean_d_by_study_x_design)) %>% 
  kable(digits = 2, format = "latex", booktabs = T) %>%
  kableExtra::kable_styling() %>% 
  clipr::write_clip()
```


```{r}
dat %>% 
  count(scale_name, sort = T) %>%
  DT::datatable()
```


##### Attitudes
How many papers measured attitudes?

```{r}
dat %>% count(scale_type, sort =T )
```

How many of those are short-term measurements?

```{r}
dat %>% 
  filter(scale_type == "attitudes") %>% 
  select(unique_study_id, delay) %>% 
  drop_na(delay) %>% 
  group_by(unique_study_id) %>% 
  mutate(max_delay = max(delay),
         only_short_term = max_delay == 0) %>% 
  count(only_short_term) %>% 
  ungroup() %>% 
  count(only_short_term)
```

Average effect size for attitude measurements, split by delay/no delay?

```{r}
dat %>%
  filter(scale_type == 'attitudes') %>% 
  split(.$delay  == 0) %>%
  map(.f = ~robust(x = rma(yi = .$d, 
               vi = .$var_d), 
       cluster = .$unique_study_id))
```


To do so, we break down our dataset according to four types of study designs: experimental studies, quasi experimental studies, and observational studies. as presented in Table X, 
```{r}
dat %>% 
  select(unique_study_id, scale_type, study_design, d) %>% 
  filter(scale_type == "behavior") %>% 
  group_by(unique_study_id, study_design) %>% 
  summarise(mean_d_by_study_x_design = mean(d)) %>% 
  group_by(study_design) %>% 
  summarise(n = n(),
            mean_d_by_design = mean(mean_d_by_study_x_design)) %>% 
  kable(digits = 2, format = "latex", booktabs = T) %>%
  kableExtra::kable_styling() %>% 
  clipr::write_clip()
```


```{r}
dat %>% 
  select(unique_study_id, scale_type, study_design, d) %>% 
  filter(scale_type == "attitudes") %>% 
  group_by(unique_study_id, study_design) %>% 
  summarise(mean_d_by_study_x_design = mean(d)) %>% 
  group_by(study_design) %>% 
  summarise(n = n(),
            mean_d_by_design = mean(mean_d_by_study_x_design)) %>% 
  kable(digits = 2, format = "latex", booktabs = T) %>%
  kableExtra::kable_styling() %>% 
  clipr::write_clip()
```

**a list of all of the papers either written by foshee or evaluate safe dates**

**a list of studies for this time perios (1985-2000) and where they were published** 

**can we pull some data here to back up these arguments? can we look at 1985-2000 and see the breakdown in terms of labratory vs. field?** 

**Also - can we say how many of these papers are dissertations vs. journal articles?**
m
**finally - can we say who are the participants in these interventions? are they mostly targeting men?**